{% extends "base.html" %}

{% block title %}Adicionar Gado - Auditoria de Rebanho{% endblock %}

{% block content %}

<section class="content-section form-section">
    <h2>Adicionar Novo Gado (Boi ou Vaca)</h2>
    <form id="add-cattle-form" action="/cattle/" method="post"> <!-- Action might be handled by JS -->
        <label for="type">Tipo:</label>
        <select id="type" name="type" required>
            <option value="" disabled selected>Selecione o tipo</option>
            <option value="cow">Vaca (Fêmea)</option>
            <option value="bull">Boi (Macho)</option>
        </select>

        <label for="name">Nome:</label>
        <input type="text" id="name" name="name" required>

        <label for="birth_date">Data de Nascimento:</label>
        <input type="date" id="birth_date" name="birth_date">

        <label for="weight">Peso (kg):</label>
        <input type="number" step="0.1" id="weight" name="weight">

        <label for="mother_id">ID da Mãe (Opcional, se Vaca):</label>
        <input type="number" id="mother_id" name="mother_id">
        <small>Deixe em branco se não aplicável ou desconhecido.</small>

        <button type="submit">Adicionar Gado</button>
    </form>
    <p><a href="/">Voltar ao Dashboard</a></p>
</section>
{% endblock %}

{% block scripts_extra %}
<!-- Add specific scripts for form validation or submission if needed -->
<script>
    // Basic JS to handle form submission via fetch API
    const addCattleForm = document.getElementById("add-cattle-form");
    if (addCattleForm) {
        addCattleForm.addEventListener("submit", async (event) => {
            event.preventDefault();
            const formData = new FormData(addCattleForm);
            const data = {
                name: formData.get("name"),
                type: formData.get("type"),
                birth_date: formData.get("birth_date") || null,
                weight: formData.get("weight") ? parseFloat(formData.get("weight")) : null,
                mother_id: formData.get("mother_id") ? parseInt(formData.get("mother_id")) : null
            };

            // Remove null fields if necessary, depending on API validation
            if (!data.birth_date) delete data.birth_date;
            if (data.weight === null) delete data.weight;
            if (data.mother_id === null) delete data.mother_id;

            try {
                const response = await fetch("/cattle/", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json",
                    },
                    body: JSON.stringify(data),
                });

                if (!response.ok) {
                    const errorData = await response.json();
                    throw new Error(errorData.detail || `HTTP error! status: ${response.status}`);
                }

                const result = await response.json();
                alert(`Gado adicionado com sucesso! ID: ${result.id}`);
                // Optionally redirect or clear form
                // window.location.href = "/";
                addCattleForm.reset();
            } catch (error) {
                console.error("Erro ao adicionar gado:", error);
                alert(`Erro ao adicionar gado: ${error.message}`);
            }
        });
    }
</script>
{% endblock %}

